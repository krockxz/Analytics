!function(){"use strict";class e{constructor(e={}){this.apiUrl=e.apiUrl||"/api/v1",this.sessionId=this.getSessionId(),this.queue=[],this.isOnline=navigator.onLine,this.batchSize=e.batchSize||10,this.flushInterval=e.flushInterval||5e3,this.init()}init(){this.trackPageView(),this.setupClickTracking(),this.setupVisibilityTracking(),this.setupOnlineOfflineTracking(),this.startPeriodicFlush(),this.setupUnloadTracking()}getSessionId(){let e=localStorage.getItem("analytics_session_id");return e||(e="sess_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),localStorage.setItem("analytics_session_id",e)),e}track(e,t={}){const i={sessionId:this.sessionId,type:e,url:window.location.href,timestamp:(new Date).toISOString(),data:{...t,userAgent:navigator.userAgent,screenWidth:window.screen.width,screenHeight:window.screen.height,viewportWidth:window.innerWidth,viewportHeight:window.innerHeight}};this.queue.push(i),("page_view"===e||this.queue.length>=this.batchSize)&&this.flush()}trackPageView(){this.track("page_view",{title:document.title,referrer:document.referrer})}trackClick(e){const t=e.target;"INPUT"===t.tagName&&"password"===t.type||this.track("click",{x:e.clientX,y:e.clientY,element:t.tagName.toLowerCase(),elementId:t.id,elementClass:t.className,elementText:t.textContent?.substring(0,100)})}setupClickTracking(){document.addEventListener("click",this.trackClick.bind(this),!0)}setupVisibilityTracking(){document.addEventListener("visibilitychange",()=>{"visible"===document.visibilityState&&this.trackPageView()})}setupOnlineOfflineTracking(){window.addEventListener("online",()=>{this.isOnline=!0,this.flush()}),window.addEventListener("offline",()=>{this.isOnline=!1})}setupUnloadTracking(){const e=()=>{if(this.queue.length>0){const e=JSON.stringify(this.queue);navigator.sendBeacon(`${this.apiUrl}/events`,e),this.queue=[]}};window.addEventListener("beforeunload",e),window.addEventListener("pagehide",e)}startPeriodicFlush(){setInterval(()=>{this.queue.length>0&&this.flush()},this.flushInterval)}async flush(){if(!this.isOnline||0===this.queue.length)return;const e=this.queue.splice(0);try{for(let t=0;t<e.length;t+=this.batchSize){const i=e.slice(t,t+this.batchSize);await fetch(`${this.apiUrl}/events`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(1===i.length?i[0]:i),keepalive:!0})}}catch(t){this.queue.unshift(...e),console.warn("Failed to send analytics events:",t)}}identify(e,t={}){this.userId=e,this.traits=t,localStorage.setItem("analytics_user_id",e),localStorage.setItem("analytics_traits",JSON.stringify(t))}reset(){localStorage.removeItem("analytics_session_id"),localStorage.removeItem("analytics_user_id"),localStorage.removeItem("analytics_traits"),this.sessionId=this.generateSessionId(),this.userId=null,this.traits={}}generateSessionId(){return"sess_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.AnalyticsTracker=new e({apiUrl:window.ANALYTICS_API_URL||"/api/v1"})}):window.AnalyticsTracker=new e({apiUrl:window.ANALYTICS_API_URL||"/api/v1"})}();
